<!DOCTYPE html>
<html>
    <head>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!--<script src="lib/jquery.min.js"></script>-->
    <script src="lib/jszip.min.js"></script>
    <script src="lib/FileSaver.js"></script>

    <title>Datapack Generator</title>

    <style>
        #nav {
            background-color: gray;
            width: 100%;
            position: fixed;
            top: 0px;
            left: 0px;
            height: 30px;
            user-select: none;
        }
        .nav {
            display: inline-block;
            margin: 0px 10px;
        }
        .nav--contextmenu {
            display: none;
            position: absolute;
            background-color: gray;
            transition: opacity 250ms;
        }
        .nav--a {
            background: transparent;
            font-size: 20px;
            line-height: 27px;
            border: none;
            color: white;
            outline: none;
        }
        .nav__selected, .nav--b:not(.disabled):hover {
            background-color: #5779da;
        }
        .nav--b.disabled {
            color: rgba(255, 255, 255, 0.3);
        }
        body {
            padding-top: 30px;
        }
        .nav--b {
            display: block;
            width: 100%;
            text-align: left;
        }
        #version {
            float: right;
            font-size: 13px;
            line-height: 30px;
            margin-right: 20px;
            color: white;
            font-family: Arial, sans-serif;
        }
        #editor {
            position: relative;
            font-size: large;
            font-family: Arial, sans-serif;
            white-space: nowrap;
            top: 60px;
        }
        #editor--display {
            position: absolute;
            color: rebeccablue;
        }
        #editor--input {
            position: absolute;
            color: transparent;
            caret-color: black;
            outline: 0;
            width: 100%;
            height: 500px;
        }
        .file {
            background: transparent;
            border: none;
            outline: 0;
            width: 100px;
        }
        #path {
            font-family: Arial, sans-serif;
            padding: 20px 0px;
        }
        #path span {
            cursor: pointer;
        }
        .window {
            background-color: lightgray;
            margin: auto;
            width: 50%;
            font-family: Arial, sans-serif;
            display: none;
            position: fixed;
            box-shadow: black 0px 0px 10px;
        }
        .window--top {
            height: 30px;
            width: 100%;
            text-align: center;
            background-color: gray;
        }
        .window--top--title {
            line-height: 30px;
            color: white;
        }
        .window--body {
            padding: 8px;
        }
        .window--input {
            outline: 0;
            padding: 5px;
        }
        .window--button {
            padding: 5px;
            background-color: lightgray;
            border: 1px solid gray;
            display: block;
            margin: 10px 0px 0px;
        }
        #newFile--error, #newFolder--error, #rename--error, #load--error, #find--error {
            background-color: pink;
            border: 2px solid red;
            color: black;
            display: none;
            border-radius: 5px;
            padding: 5px;
            margin-top: 1em;
        }
        #newFolder--path, #newFile--path {
            margin-left: 10px;
            width: 291px;
        }
        .window--top--close {
            color: white;
            float: right;
            margin-right: 7px;
            font-size: 30px;
            cursor: pointer;
        }
        #contextmenu {
            background-color: rgb(246, 246, 246);
            border: 1px solid rgb(165, 165, 165);
            border-radius: 10px;
            padding: 5px 15px;
            display: none; /* inline-block when visible*/
            box-shadow: 1px 1px 5px 0px rgba(128, 128, 128, 0.5);
            position: fixed;
            transition: opacity 250ms;
            z-index: 12;
        }
        .contextmenu--option {
            margin: 0px;
            width: calc(100% + 15px);
            height: 20px;
            line-height: 20px;
            font-family: Arial, sans-serif;
            cursor: default;
            padding-left: 15px;
            margin-left: -15px;
        }
        .contextmenu--option:not(.disabled):hover {
            background-color: rgb(60, 133, 254);
            color: white;
        }
        .contextmenu--option.disabled {
            color: #ccc;
        }
        #rename--path {
            display: none;
        }
        #load--progress {
            display: none;
            width: 100%;
        }
        .file--name {
            word-break: break-all;
        }
        .settings--subtitle, .news--subtitle {
            font-size: 1.2em;
            border-bottom: 1px solid gray;
            padding-bottom: 15px;
            margin-bottom: 15px;
        }
        .styleEditor--remove {
            margin-left: 6px;
            cursor: pointer;
            font-size: 17px;
            position: absolute;
            margin-top: 4px;
        }
        .styleEditor--add {
            font-size: 20px;
        }
        .styleEditor--remove--container {
            display: inline;
            position: relative;
        }
        #settings .window--body {
            height: 300px;
            overflow: auto;
        }
        #find--find, #find--replace {
            width: calc(100% - 15px);
        }
        #settings--syntaxStyle--load--input {
            display: none;
        }
        #news {
            transition: opacity 1s;
            opacity: 0;
        }
        #find--type {
            padding-bottom: 20px;
            margin-bottom: 20px;
            border-bottom: 1px solid gray;
        }
        #find--this {
            margin-left: 30px;
        }
        .find--link {
            cursor: pointer;
            text-decoration: underline;
        }
        #editor--autocomplete {
            background-color: gray;
            color: white;
            position: fixed;
            cursor: pointer;
        }
        .editor--autocomplete--option {
            margin: 0px;
            padding: 5px;
            pointer: cursor;
            font-family: Arial, sans-serif;
        }
        .editor--autocomplete--option.selected {
            background-color: blue;
        }
        .editor--autocomplete--option:not(.selected):hover {
            background-color: #b3b3b3;
        }
    </style><!-- qfstyle -->
    <style id="syntaxStyle">
        syntax.error {
            background-color: rgba(255, 0, 0, 0.5);
        }
        syntax.comment {
            color: #808080;
            font-style: italic;
        }
        syntax.entity_selector {
            color: #008000;
        }
        syntax.entity_selector_inside {
            color: #32cd32;
        }
        syntax.string {
            color: #c83232;
        }
        syntax.entity_selector_not {
            color: #963232;
        }
        syntax.entity_selector_comma {
            color: #000000;
        }
        syntax.function {
            color: #be3c82;
        }
    </style>
    <script>
        //  -------------  //
        //    Variables    //
        //  -------------  //
        const VERSION = "2.0";
        const NBSP = "Â ";
        const cl = console.log;
        let editor;
        let editingFile;
        let currentPath;
        let autoCompleteIndex = 0;
        let contextmenuOpen = {
            contextmenu : null,
            a           : null
        };
        const settings = {
            syntaxhighlight : true,
            syntaxStyle     : {
                error : [
                    ["background-color", "rgba(255, 0, 0, 0.5)"] /* opodo - styles are defined in two places, here and in the #syntaxStyle, make a function that either generates the settings on load or makes the #syntaxStyle on load from the settings*/
                ],
                comment : [
                    ["color", "#808080"],
                    ["font-style", "italic"]
                ],
                entity_selector : [
                    ["color", "#008000"]
                ],
                entity_selector_inside : [
                    ["color", "#32cd32"]
                ],
                string : [
                    ["color", "#c83232"]
                ],
                entity_selector_not : [
                    ["color", "#963232"]
                ],
                entity_selector_comma : [
                    ["color", "#000000"]
                ],
                function : [
                    ["color", "#be3c82"]
                ],
            }
        };

        //  -------------  //
        //     Classes     //
        //  -------------  //

        class FileSystem {

            constructor(name) {

                this.files = new dpFileList();
                this.name = name;

            }

            addFile(file) {

                file.fileSystem = this;
                this.files.push(file);

            }

            getFile(fullPath) {

                for (let i = 0; i < this.files.length; i++) {

                    if (this.files[i].fullPath == fullPath) return this.files[i];

                }

                return null;

            }

            addFolder(path) {

                this.files.push(new dpFolder(path));

            }

            removePath(path) {

                if (path.endsWith("/")) this.removeDirectory(path);
                else this.removeFile(path);

            }

            removeFile(path) {

                for (let i = 0; i < this.files.length; i++) {

                    if (this.files[i].fullPath == path) {

                        deleted.addFile(this.files[i]);
                        this.files.splice(i, 1); /* remove the file from the files list */
                        return;

                    }

                }

            }

            removeDirectory(path) {

                for (let i = this.files.length - 1; i >= 0; i--) {

                    if (this.files[i].fullPath.startsWith(path)) {

                        deleted.addFile(this.files[i]);

                        this.files[i].path = this.files[i].path.substr(path.split("/").slice(0,-2).join("/").length + 1);

                        this.files.splice(i, 1); /* remove the file from the files list */

                    }

                }

            }

            getDirectory(path) {

                if (path == "/") {

                    const fileList = this.files;

                    fileList.path = path;
                    fileList.fileSystem = this;
                    return fileList;

                }

                if ((!path.endsWith("/")) && (path != "")) throw new Error("Path has to be a directory(end with /)");

                const fileList = new dpFileList();

                for (let i = 0; i < this.files.length; i++) {

                    if (this.files[i].fullPath.startsWith(path)) fileList.push(this.files[i]);

                }

                fileList.path = path;
                fileList.fileSystem = this;

                return fileList;

            }

            download() {

                const zip = new JSZip();

                for (let i = 0; i < this.files.length; i++) {

                    zip.file(this.files[i].fullPath, this.files[i].value);

                }

                zip.generateAsync({type:"blob"}).then(content => saveAs(content, this.name + ".zip"));

            }

        }

        class dpFile {

            constructor(path, name, value = "", fileSystem, type = "text", blob) {

                this.path  = path;
                this.name  = name;
                this.value = value;
                this.fileSystem = fileSystem;
                this.type = type;
                this.blob = blob;

                if ((this.path != "") && (!this.path.endsWith("/"))) this.path += "/";

                return this;

            }

            hasSubdirectories(path) {

                const relPath = this.path.substr(path.length);

                return (relPath.includes("/"))

            }

            openInEditor(saveOld = true) {

                if (saveOld && editingFile) {

                    editingFile.saveFromEditor();
                    editingFile = null;

                }

                const editor = $("#editor--input");

                $("#editor").show();
                editor.show();
                $("#editor--display").show();
                $("#dir").hide();

                if (this.type == "text") {

                    const split = this.value.split("\n");
                    let text = "";

                    for (let i = 0; i < split.length; i++) {

                        text += "<div>" + (split[i].length ? split[i] : "<br>") + "</div>";

                    }

                    text = text.replace(/ /g, NBSP); // spaces to nbsp

                    editor.html(text);
                    updateEditorDisplay();

                    updatePath(this.fullPath, this.fileSystem, true);

                    editingFile = this;

                } else if (this.type == "image") {

                    editor.html("").hide();
                    $("#editor--display").html("").append($("<img>").attr("src", this.value));

                    updatePath(this.fullPath, this.fileSystem, true);

                    editingFile = this;

                } else if (this.type == "blob") {

                    $("#editor--display").text("We do not know how to open this file");
                    editor.hide();

                    editingFile = this;

                    // TODO allow the user to choose how to display the file, read the blob as with a filereader as text or whatever

                }

            }

            saveFromEditor() {

                const editor = $("#editor--input");

                this.value = editor[0].innerText.replace(/\n\n/g, "\n");

            }

            getFileExtension() {

                return this.name.substr(this.name.lastIndexOf(".")+1);

            }

            get fullPath() {

                if (!this.path) return this.name; // if path is "" return just the name;

                return this.path + this.name;

            }

        }

        class dpFolder {

            constructor(path) {

                this.isFolder = true;
                this.path = path;

                if (!this.path.endsWith("/")) this.path += "/";

            }

            get fullPath() {

                return this.path;

            }

        }

        class dpFileList extends Array {

            constructor(arr) {

                super();

                if (!arr) return;

                for (var i = 0; i < arr.length; i++) {

                    this.push(arr[i]);

                }

            }

            // Displays the files on the screen (#dir)
            display() {

                if (this.path == undefined) throw new Error("Can not display a folder that isn't a directory");

                cl(`Displaying directory ${this.path}`);

                if (editingFile) {

                    editingFile.saveFromEditor();
                    editingFile = null;

                }

                currentFs = this.fileSystem;

                const dir = $("#dir");
                const files = [];
                const addedFolders = [];

                dir.show();
                $("#editor").hide();
                dir.find(".file").remove();

                for (var i = 0; i < this.length; i++) {

                    const file = this[i];
                    const hasSub = file.hasSubdirectories(this.path);
                    let folderName;

                    let img = "img/unknown_file.png";
                    if (file.getFileExtension() == "mcfunction") img = "img/mcfunction_file.png";
                    if (hasSub) {

                        folderName = file.path.substr(this.path.length).split("/")[0];

                        if (addedFolders.includes(folderName)) continue;

                        img = "img/folder.png";
                        addedFolders.push(folderName);

                    }

                    let toAdd = $("<button></button>").attr("class", "file").html('<img src="'+ img +'"><p></p>');
                    toAdd.find("img").attr("width", 64).attr("height", 64);
                    if (!hasSub) {

                        toAdd.find("p").text(file.name).addClass("file--name");
                        toAdd.attr("path", file.fullPath);
                        toAdd.on("click", e => {

                            this.fileSystem.getFile(file.fullPath).openInEditor();

                        });

                    } else {

                        toAdd.find("p").text(folderName).addClass("file--name");

                        const folderPath = this.path + file.path.substr(this.path.length).split("/")[0] + "/";

                        toAdd.attr("path", folderPath);

                        toAdd.on("click", e => {

                            this.fileSystem.getDirectory(folderPath).display();

                        });

                    }

                    files.push(toAdd);

                }

                files.sort((a, b) => {

                    if (a.name < b.name) return 1;
                    else if (a.name > b.name) return -1;
                    else return 0;

                });

                for (let i = 0; i < files.length; i++) {

                    dir.append(files[i]);

                }

                updatePath(this.path, this.fileSystem);

            }

        }

        const fs = new FileSystem("datapack");

        fs.addFile(new dpFile("", "pack.mcmeta", '{\nÂ Â "pack": {\nÂ Â Â Â "pack_format": 1,\nÂ Â Â Â "description": ""\nÂ Â }\n}', fs));
        fs.addFile(new dpFile("data/default/functions/", "default.mcfunction", "execute as @a[tag=!something] run function default:test", fs));

        const deleted = new FileSystem("deleted");

        currentFs = fs;

        //  --------------------  //
        //     document.ready     //
        //  --------------------  //

        $(document).ready(() => {
            $(document).on("beforeunload", e => {

                return "Are you sure you want to leave?";

            });
            $("#view").on("click", e => {

                let str = "Enter fullscreen";

                if (isInFullscreen()) str = "Exit fullscreen";

                $("#nav--fullscreen").text(str);

            });
            $(".nav--a:not(.nav--b)").on("click", e => {

                const elem = e.target;

                const cm = elem.parentNode.getElementsByClassName("nav--contextmenu")[0];

                if (cm) openNavContextMenu(cm);

            }).on("mouseover", e => {

                if ((contextmenuOpen.a) && (contextmenuOpen.a != e.currentTarget)) {

                    closeNavContextMenu(contextmenuOpen.contextmenu, true);

                    const ct = $(e.currentTarget).parent().find(".nav--contextmenu");

                    ct.css("display", 'block');

                    e.currentTarget.classList.add("nav__selected");
                    contextmenuOpen.a = e.currentTarget;
                    contextmenuOpen.contextmenu = ct[0];

                }

            });
            $("#nav--fullscreen").on("click", e => {

                if (isInFullscreen()) exitFullscreen();
                else enterFullscreen();

            });
            $("#nav--download").on("click", e=> {

                fs.download();

            });
            $("#nav--newfile").on("click", newFile);
            $("#nav--newfolder").on("click", newFolder);
            $("#nav--resetdir").on("click", e=> {

                fs.getDirectory("").display();

            });
            $("#nav--settings").on("click", openSettings);
            $("#nav--load").on("click", e => {

                $(".window#load").show();
                $("#load--error").hide();

            });
            $("#nav--deleted").on("click", e => {

                deleted.getDirectory("").display();

            });
            $("#nav--find").on("click", e => {

                openFind();

            });
            $("#nav--news").on("click", e => {

                const $window = $(".window#news");

                $window.show();
                center($window[0]);

            });
            $("#editor--input").on("input", updateEditorDisplay)
            .on("keyup click focus", e => {

                $("#editor--autocomplete").remove();

                const selection = window.getSelection();

                if (!selection.rangeCount) return;

                const range = selection.getRangeAt(0);

                const text = range.startContainer.textContent.substr(0, range.startOffset);

                if (text.endsWith("function"+ NBSP)) {

                    const coords = getCaretPos();
                    const $toAdd = $("<div></div>").attr("id", "editor--autocomplete");
                    const OFFSET = 16;

                    $toAdd.css("left", coords.x + "px").css("bottom", "calc(100% - "+ coords.y +"px)");

                    $(document.body).append($toAdd);

                    const namespaces = [];

                    let j = 0;
                    for (let i = 0; i < currentFs.files.length; i++) {

                        const file = currentFs.files[i];

                        if (file.path.startsWith("data/")) {

                            namespaces.push(file.path.split("/")[1]);
                            //$toAdd.append(file.path.split("/")[1] + ":<br>");
                            $toAdd.append($("<p></p>").text(file.path.split("/")[1]).addClass("editor--autocomplete--option").attr("index", j));

                            j++;

                        }

                    }

                    $toAdd.find(".editor--autocomplete--option").eq(autoCompleteIndex).addClass("selected");

                }

            }).on("keydown", e => {

                const $autocomplete = $("#editor--autocomplete");

                if ($autocomplete) {

                    if (e.key == "Tab") {

                        e.preventDefault();

                        const text = $(".editor--autocomplete--option.selected").text();

                        autoComplete(text);

                    } else if (e.key == "ArrowDown" || e.key == "ArrowUp") {

                        e.preventDefault();

                        const $option = $(".editor--autocomplete--option.selected");
                        const index = parseInt($option.attr("index"));
                        const newIndex = index + (e.key == "ArrowDown" ? 1 : -1);

                        let $newOption = $(".editor--autocomplete--option[index="+ newIndex +"]");

                        if (!$newOption.length) {

                            if (newIndex == -1) {

                                $newOption = $(".editor--autocomplete--option").last();
                                autoCompleteIndex = $(".editor--autocomplete--option").length - 1;

                            } else {

                                $newOption = $(".editor--autocomplete--option").first();
                                autoCompleteIndex = 0;

                            } 

                        } else {

                            autoCompleteIndex = newIndex;

                        }

                        $(".editor--autocomplete--option").removeClass("selected");
                        $newOption.addClass("selected");

                    }

                }

            })
            .on("blur", e => {

                $("#editor--autocomplete").remove();

            });
            $(".nav--contextmenu").on("click", e => {

                closeNavContextMenu(e.currentTarget);

            });
            $("#newFile--create").on("click", e => {

                const name = $("#newFile--name").val();
                const path = $("#newFile--path").val();
                const ext  = $("#newFile--extension").val();
                const fullName = name + (ext ? "." + ext : "");
                const error = $("#newFile--error");

                if (!name) {

                    error.html("Name can't be empty");
                    error.css("display", "block");
                    return;

                }

                const file = new dpFile(path, fullName, "", currentFs);

                currentFs.addFile(file);

                $(".window#newFile").hide();

                currentFs.getDirectory(currentPath).display();

            });
            $("#rename--go").on("click", e => {
                
                const name = $("#rename--name").val();
                const path = $("#rename--path").val();
                const ext  = $("#rename--ext").val();
                const fullName = name + (ext ? "." + ext : "");
                const error = $("#rename--error");
                const file = currentFs.getFile(path);
                
                if (!name) {

                    error.html("Name can't be empty");
                    error.css("display", "block");
                    return;

                }

                file.name = fullName;
                currentFs.getDirectory(currentPath).display();

            });
            $("#load--go").on("click", e => {

                const fileInput = $("#load--file");

                const file = fileInput[0].files[0];
                const error = $("#load--error");

                if (!file) {

                    error.text("No file selected!").css("display","block");
                    return;

                }

                if (!file.name.endsWith(".zip")) {

                    error.text("The file you selected isn't a zip file").css("display","block");
                    return;

                }

                //if (!confirm("Are you sure?")) return;

                fileInput.val("");

                const loadProgress = $("#load--progress");
                loadProgress.show();
                loadProgress.val(0);

                fs.files = new dpFileList();
                fs.name = file.name.slice(0, -4);

                JSZip.loadAsync(file).then(zip => {

                    const total = Object.keys(zip.files).length;
                    loadProgress.attr("max", total);
                    let loadedFiles = 0;

                    function loadedFile() {

                        loadedFiles++;
                        loadProgress.val(loadedFiles);

                         if (loadedFiles >= total) {

                             $("#load--info").append("The file has been loaded");
                             currentFs.getDirectory("").display();

                         }

                    }

                    zip.forEach((path, file) => {

                        let loadType;

                        if (path.endsWith("/")) {

                            loadedFile();
                            return;

                        }

                        const _path = path.substr(0, path.lastIndexOf("/")+1);
                        const name = path.substr(path.lastIndexOf("/")+1);

                        if ((path.endsWith(".mcmeta"))
                         || (path.endsWith(".mcfunction"))
                         || (path.endsWith(".txt"))
                         || (path.endsWith(".json"))) {

                             loadType = "text";

                         } else if ((path.endsWith("png"))) {

                             loadType = "base64";

                         }

                         if (loadType == "text") {

                             file.async("text").then(txt => {

                                 fs.addFile(new dpFile(_path, name, txt, fs));

                                 loadedFile();

                             });

                         } else if (loadType == "base64") {

                             file.async("base64").then(res => {

                                 fs.addFile(new dpFile(_path, name, "data:image/png;base64," + res, fs, "image"));

                                 loadedFile();

                             });

                         } else {

                             file.async("blob").then(res => {

                                 fs.addFile(new dpFile(_path, name, "", fs, "blob", res));

                                 loadedFile();

                             });

                         }

                    });

                }, error => {

                    error.append("Error reading zip: "+ error.message + "<br>").css("display", "block");

                });

            });
            $(".window--top--close").on("click", e => {

                $(e.currentTarget).parent().parent().hide();

            });
            $("#editor--input").on("paste", e => {

                const event = e.originalEvent;

                const data = (event.clipboardData || window.clipboardData);

                data.setData("text/html", data.getData("text"));

            });
            $(".window--top").on("mousedown", e => {

                const wind = $(e.currentTarget).parent();

                const windowBox = wind[0].getBoundingClientRect();

                const start = {
                    windowX : windowBox.left,
                    windowY : windowBox.top,
                    mouseX  : e.clientX,
                    mouseY  : e.clientY
                };

                $(document).on("mousemove", e => {

                    let x = start.windowX + e.clientX - start.mouseX;
                    let y = start.windowY + e.clientY - start.mouseY;

                    const minX = 0;
                    const maxX = Math.ceil(window.innerWidth - windowBox.width);

                    const minY = 30;
                    const maxY = Math.ceil(window.innerHeight - windowBox.height);

                    if (y < minY) y = minY;
                    if (y > maxY) y = maxY;
                    if (x < minX) x = minX;
                    if (x > maxX) x = maxX;

                    wind.css("left", x + "px");
                    wind.css("top", y + "px");

                    window.getSelection().removeAllRanges();

                });

            });

             // ".window--top"
            $(document).on("mouseup", e => {

                $(document).off("mousemove"); // opodo - give the event a name/id and remove it and not all.

            });
            $(".window").on("mousedown", e => {

                $(".window").css("zIndex", 10);
                $(e.currentTarget).css("zIndex", 11);

            });
            $("#settings--syntaxStyle--download").on("click", e => {

                const $syntaxStyle = $("#syntaxStyle");
                const text = $.trim($syntaxStyle.html().replace(/        /g, ""));
                const blob = new Blob([text], {"type": "text/css"});

                saveAs(blob, "syntaxStyle.css");

            });
            $("#settings--syntaxStyle--load").on("click", e => {

                $("#settings--syntaxStyle--load--input").click();

            });
            $("#settings--syntaxStyle--load--input").on("change", e => {

                const file = $("#settings--syntaxStyle--load--input")[0].files[0];

                const reader = new FileReader();

                reader.onloadend = () => {

                    $("#syntaxStyle").html(reader.result);

                    updateSettingsStyleEditor();

                    let readingSyntax;

                    for (let i = 0; i < reader.result.length; i++) {

                        if (reader.result[i] == " ") continue;
                        else if (reader.result[i] == "}") readingSyntax = null;
                        else if (reader.result.substr(i, 6) == "syntax") {

                            readingSyntax = reader.result.substr(i+7).split(" ")[0].split("{")[0];
                            i += reader.result.substr(i+7).indexOf("{") + 8;

                            settings.syntaxStyle[readingSyntax] = [];

                            cl(`Reading syntax: "${readingSyntax}"`);

                        }
                        else if (readingSyntax) {

                            const key = reader.result.substr(i, reader.result.substr(i).indexOf(":"));
                            const value = $.trim(reader.result.substring(reader.result.substr(i).indexOf(":")+1+i, reader.result.substr(i).indexOf(";")+i));

                            settings.syntaxStyle[readingSyntax].push([key, value]);

                            const oldI = i;

                            i += reader.result.substr(i).indexOf(";")+1;

                            if (i <= oldI) {

                                console.warn("The new i is less or equal to the old i!, broke");
                                break;

                            }

                        }

                    }

                    cl("Loaded syntaxStyle!");

                };

                reader.readAsText(file);

            });
            $("#find--find").on("input", e => {

                const toFind = $("#find--find").val();
                const $result = $("#find--result");

                $("#find--error").hide().html("");

                if ($("#find--all")[0].checked) {

                    $result.text("Found "+ toFind +" in these files:").append("<br><br>");

                    for (let i = 0; i < currentFs.files.length; i++) {

                        const file = currentFs.files[i];

                        if (file.value.includes(toFind) || file.name.includes(toFind)) {

                            $result.append($("<span></span>").text(file.name).addClass("find--link").on("click", e => { file.openInEditor() })).append("<br>");

                        }

                    }

                } else {

                    $("#find--result").html("");

                    if (!editingFile) {

                        $("#find--error").append("You are not in a file<br>").show();
                        return;

                    }

                    $("#find--error").append("You can't find in one file, this feature will be added soon! You can find in all files and replace in one or all files<br>").show();

                }

            });

            $("#find--replace--go").on("click", e => {

                const toFind = $("#find--find").val();
                const toFindRegExp = new RegExp(toFind, "g");
                const toReplace = $("#find--replace").val();

                $("#find--error").hide().html("");

                if ($("#find--all")[0].checked) {

                    for (let i = 0; i < currentFs.files.length; i++) {

                        const file = currentFs.files[i];

                        if (file.value.includes(toFind)) {

                            file.value = file.value.replace(toFindRegExp, toReplace);
                            file.openInEditor(false);

                        }

                    }

                } else {

                    if (!editingFile) {

                        $("#find--error").append("You are not in a file<br>").show();
                        return;

                    }

                    editingFile.value = editingFile.value.replace(toFindRegExp, toReplace);
                    editingFile.openInEditor(false);

                }

            });

            /* qfready qfdocument.ready qfdocumentready qfdocready qfdr */

            center($(".window#news").show()[0]);
            $(".window#news").css("opacity", 1);
            $(document).on("keydown", e => {

                if (e.key == "f" && (e.metaKey || e.ctrlKey)) {

                    e.preventDefault();
                    openFind();

                }

            });
            $("#editor").on("contextmenu", e => {

                const sel = window.getSelection();

                if (sel.anchorNode.nodeType == Node.TEXT_NODE) {

                    const val = sel.anchorNode.nodeValue;

                    const before = val.substring(0, sel.anchorOffset);
                    const after = val.substring(sel.anchorOffset);

                    if (before.match(/(function\s?)$/)) {

                        if (after.includes(":") && !after.startsWith("#")) {

                            const split = after.split(":");
                            const namespace = split[0];
                            const func = split[1];

                            const fullPath = "data/"+ namespace + "/functions/"+ func +".mcfunction";

                            const file = currentFs.getFile(fullPath);

                            const contextmenu = $("#contextmenu");

                            e.preventDefault();

                            contextmenu.css("display","inline-block")
                            .css("left", e.clientX + "px")
                            .css("top", e.clientY + "px")
                            .html("");

                            if (file) {

                                contextmenu.append($("<p></p>").text("Open mcfunction file").attr("class", "contextmenu--option").on("click", e => {

                                    file.openInEditor();
                                    closeContextmenu();

                                }));

                            } else {

                                contextmenu.append($("<p></p>").text("Create mcfunction file").attr("class", "contextmenu--option").on("click", e => {

                                    const path = "data/"+ namespace + "/functions/";
                                    const name = func +".mcfunction";

                                    const newFile = new dpFile(path, name, "", currentFs);

                                    currentFs.addFile(newFile);

                                    newFile.openInEditor();

                                    closeContextmenu();

                                }));

                            }

                        }

                    }

                }

            });
            $(document).on("contextmenu", e => {

                function getElementByClass(array, clazz) {

                    for (let i = 0; i < array.length; i++) {

                        if (array[i].className == clazz) return array[i];

                    }

                    return null;

                }

                function getElementById(array, id) {

                    for (let i = 0; i < array.length; i++) {

                        if (array[i].id == id) return array[i];

                    }

                    return null;

                }

                function show(contextmenu) {

                    e.preventDefault();

                    contextmenu.css("display","inline-block")
                    .css("left", e.clientX + "px")
                    .css("top", e.clientY + "px")
                    .html("");

                }

                const path = e.originalEvent.composedPath();
                const file = $(getElementByClass(path, "file"));
                const dir = getElementById(path, "dir");

                if (file[0]) {

                    cl("Clicked on a file");

                    const contextmenu = $("#contextmenu");
                    const path = $(file).attr("path");

                    show(contextmenu);

                    contextmenu.append($("<p></p>").text("Open").attr("class", "contextmenu--option").on("click", e => {

                        file.click();
                        closeContextmenu();

                    }));
                    contextmenu.append($("<p></p>").text("Rename").attr("class", "contextmenu--option").on("click", e => {

                        rename(); // Open rename window
                        $("#rename--path").val(path);

                        const _file = currentFs.getFile(path);
                        const name = _file.name.split(".")[0];
                        const ext = _file.getFileExtension();

                        $("#rename--name").val(name);
                        $("#rename--ext").val(ext);

                        closeContextmenu();

                    }));
                    contextmenu.append($("<p></p>").text("Delete").attr("class", "contextmenu--option").on("click", e => {

                        currentFs.removePath($(file).attr("path"));
                        currentFs.getDirectory(currentPath).display();
                        closeContextmenu();

                    }));
                    
                    if ((path.endsWith(".mcfunction"))) {

                        const cmEntry = $("<p></p>").text("Add to tick.json").addClass("contextmenu--option");
                        const cmEntry2 = $("<p></p>").text("Add to load.json").addClass("contextmenu--option");
                        const tickjson = currentFs.getFile("data/minecraft/tags/functions/tick.json");
                        const loadjson = currentFs.getFile("data/minecraft/tags/functions/load.json");
                        const split = path.split("/");

                        if (split.length >= 3) {

                            const fileName = split.slice(3).join("/");
                            const functionPath = split[1] +":"+ fileName.substr(0, fileName.lastIndexOf("."));

                            // tick.json

                            if (tickjson && tickjson.value.includes(functionPath)) {

                                cmEntry.addClass("disabled");
                                contextmenu.append(cmEntry);

                            } else {

                                contextmenu.append(cmEntry);

                                if (!tickjson) {

                                    cmEntry.on("click", e => {

                                        currentFs.addFile(new dpFile("data/minecraft/tags/functions/", "tick.json", '{\n    "values":[\n        "'+ functionPath +'"\n    ]\n}', currentFs));
                                        closeContextmenu();

                                    });

                                } else {

                                    cmEntry.on("click", e => {

                                        tickjson.value = tickjson.value.slice(0, -8) +',\n        "'+ functionPath +'"\n    ]\n}';
                                        closeContextmenu();

                                    });

                                }

                            }


                            // load.json


                            if (loadjson && loadjson.value.includes(functionPath)) {

                                cmEntry2.addClass("disabled");
                                contextmenu.append(cmEntry2);

                            } else {

                                contextmenu.append(cmEntry2);

                                if (!loadjson) {

                                    cmEntry2.on("click", e => {

                                        currentFs.addFile(new dpFile("data/minecraft/tags/functions/", "load.json", '{\n    "values":[\n        "'+ functionPath +'"\n    ]\n}', currentFs));
                                        closeContextmenu();

                                    });

                                } else {

                                    cmEntry2.on("click", e => {

                                        loadjson.value = loadjson.value.slice(0, -8) +',\n        "'+ functionPath +'"\n    ]\n}';
                                        closeContextmenu();

                                    });

                                }

                            }


                        }
                        
                    }


                } else if (dir) {

                    cl("Clicked on the dir");

                    const contextmenu = $("#contextmenu");

                    show(contextmenu);

                    contextmenu.append($("<p></p>").text("New File").attr("class", "contextmenu--option").on("click", e => {

                        newFile();
                        closeContextmenu();

                    }));
                    contextmenu.append($("<p></p>").text("New Folder").attr("class", "contextmenu--option").on("click", e => {

                        newFolder();
                        closeContextmenu();

                    }));

                }

            });
            $("#version").text(VERSION);
            $("title").append(" " + VERSION);
            fs.getDirectory("").display();
        });
        
        $(document).on("click", event => {

            // if the event is from elem.click() then return
            if (!event.originalEvent) return;

            const path = event.originalEvent.composedPath();
                      
            if (contextmenuOpen.a) {

                if (!((path.includes(contextmenuOpen.a)) || (path.includes(contextmenuOpen.contextmenu)))) {
                    
                    closeNavContextMenu(contextmenuOpen.contextmenu);
                    
                }
                                
            }

            const contextmenu = $("#contextmenu");

            if ((contextmenu.is(":visible")) && (!path.includes(contextmenu[0]))) {

                closeContextmenu();

            }
                                
        });

        //  -------------  //
        //    Functions    //
        //  -------------  //

        function isInFullscreen() {

            // https://stackoverflow.com/a/36672683

            return (document.fullscreenElement       && document.fullscreenElement       !== null)
                || (document.webkitFullscreenElement && document.webkitFullscreenElement !== null)
                || (document.mozFullScreenElement    && document.mozFullScreenElement    !== null)
                || (document.msFullscreenElement     && document.msFullscreenElement     !== null);

        }
        function enterFullscreen() {

            const html = $("html").get(0);

            if      (html.requestFullscreen)       html.requestFullscreen();
            else if (html.mozRequestFullScreen)    html.mozRequestFullScreen();
            else if (html.webkitRequestFullScreen) html.webkitRequestFullScreen();
            else if (html.msRequestFullscreen)     html.msRequestFullscreen();

        }
        function exitFullscreen() {

            // https://stackoverflow.com/a/36672683

            if      (document.exitFullscreen)       document.exitFullscreen();
            else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
            else if (document.mozCancelFullScreen)  document.mozCancelFullScreen();
            else if (document.msExitFullscreen)     document.msExitFullscreen()

        }
        function closeNavContextMenu(_contextMenu, instant) {

            const contextMenu = $(_contextMenu);

            contextMenu.css("opacity", 0);
            contextmenuOpen = {};
            if (!instant) {
                setTimeout(() => {

                    contextMenu.css("display", "none").css("opacity", 1);
                    contextMenu.parent().find(".nav--a").removeClass("nav__selected");

                }, 250);
            } else {

                contextMenu.css("display", "none").css("opacity", 1);
                contextMenu.parent().find(".nav--a").removeClass("nav__selected");

            }

        }
        function openNavContextMenu(_contextMenu) {

            const contextMenu = $(_contextMenu);
            const navA = contextMenu.parent().find(".nav--a:not(.nav--b)");

            if (contextmenuOpen.contextmenu) closeNavContextMenu(contextmenuOpen.contextmenu);

            contextmenuOpen.a = navA[0];
            contextmenuOpen.contextmenu = contextMenu[0];
            contextMenu.css("display", "block");
            navA.addClass("nav__selected");

        }
        function syntaxHighlight(text) {

            if (!settings.syntaxhighlight) return text.replace(/\n/g, "<br>");

            function syntax(syn, text, noEnd) {

                if (!noEnd) return '<syntax class="'+ syn +'">'+ text + '</syntax>';
                else        return '<syntax class="'+ syn +'">'+ text;

            }

            let resText = "";

            let comment = false;
            let string = false;
            let entitySelector = false;

            for (let i = 0; i < text.length; i++) {

               if ((comment) && (text[i] == "\n")) {
                    resText += "\n</syntax>";
                    comment = false;
               }
               else if (comment) resText += text[i];
               else if ((text[i] == '"') && !((text[i-1] == "\\") || (text[i-1] == undefined))) {
                    if (string) {
                        string = false;
                        resText += '"</syntax>';
                    } else {
                        string = true;
                        resText += syntax("string",'"',true);
                    }
                }
                else if ((string) && (text[i] == "\n")) {
                    resText += "</syntax>\n"; // OPODO a new line has been opened but the string still hasn't been closed, warn the user?
                }
                else if (string) {
                    resText += text[i];
                    continue;
                }
                else if ((text[i] == "/") && ((text[i-1] == "\n") || (text[i-1] == undefined))) resText += syntax("error", "/");
                else if ((text[i] == "#") && ((text[i-1] == "\n") || (text[i-1] == undefined))) {
                    comment = true;
                    resText += syntax("comment", "#", true);
                }
                else if ((text[i] == "@") && ((text[i+1] == "a") || (text[i+1] == "e") || (text[i+1] == "s") || (text[i+1] == "p") || (text[i+1] == "r"))) {
                    if (text[i+2] == "[") {
                        resText += syntax("entity_selector", text[i] + text[i+1] + text[i+2]) + syntax("entity_selector_inside", "", true);
                        i += 2;
                        entitySelector = true;
                    } else {
                        resText += syntax("entity_selector", text[i] + text[i+1]);
                        i++;
                    }

                }
                else if ((entitySelector) && (text[i] == "]")) {
                    resText += "</syntax>" + syntax("entity_selector", "]");
                    entitySelector = false;
                }
                else if ((entitySelector) && (text[i] == "!")) resText += syntax("entity_selector_not","!");
                else if ((entitySelector) && (text[i] == ",")) resText += syntax("entity_selector_comma", ",");
                else if (text.substr(i, 8) == "function") {

                    let txt = "function";
                    const after = text.substr(i+14).split("\n")[0].split(" ")[0].split(NBSP)[0].split("&nbsp;")[0];

                    if (after.includes(":")) txt += "&nbsp;"+ after;

                    resText += syntax("function", txt);
                    i += txt.length - 1;

                }
                else resText += text[i];

            }

            resText = resText.replace(/\n/g, "<br>");

            return resText;

        }
        function updateEditorDisplay() {

            const input = $("#editor--input");

            // replace all text nodes with divs
            input.contents().each((index, node) => {

                if (node.nodeType == Node.TEXT_NODE) {

                    const toAdd = document.createElement('div');
                    node.before(toAdd);
                    toAdd.appendChild(node);

                }

            });

            const val = input.html().replace(/<div>/g,"").replace(/<br>/g,"").replace(/<\/div>/g,"\n");

            const syntax = syntaxHighlight(val);

            $("#editor--display").html(syntax);

        }
        function updatePath(path, fileSystem, isFile) {

            currentPath = path;

            if (isFile) {

                $("#nav--newfile").addClass("disabled");
                $("#nav--newfolder").addClass("disabled");

            } else {

                $("#nav--newfile").removeClass("disabled");
                $("#nav--newfolder").removeClass("disabled");

            }

            const pathDiv = $("#path");

            pathDiv.html("");

            pathDiv.append($("<span></span>").text(fileSystem.name).on("click", e => { fileSystem.getDirectory("").display() }));
            pathDiv.append(" / ");

            const split = path.split("/");

            for (let i = 0; i < split.length; i++) {

                if (i == split.length-1) {

                    if (isFile) {

                        const toAdd = $("<span></span>").text(split[i]).on("click", e => {

                            fileSystem.getFile(path).openInEditor();

                        });

                        pathDiv.append(toAdd);

                        break;

                    } else {

                        break;

                    }

                }

                const toAdd = $("<span></span>").text(split[i]).on("click", e => {

                    fileSystem.getDirectory(split.slice(0, i+1).join("/") + "/").display();

                });

                pathDiv.append(toAdd);
                pathDiv.append(" / ");

            }

        }

        function closeContextmenu() {

            const contextmenu = $("#contextmenu");

            contextmenu.css("opacity", 0);
            setTimeout(() => {

                contextmenu.css("opacity", 1);
                contextmenu.hide();

            }, 250);

        }
        function newFile() {
            
            const $window = $(".window#newFile");

            $window.show().css("zIndex", 11);

            center($window[0]);

            $("#newFile--name").val("");
            $("#newFile--path").val(currentPath);
            $("#newFile--error").hide();
            
        }
        function newFolder() {
            
            const $window = $(".window#newFolder");

            $window.show().css("zIndex", 11);

            center($window[0]);

            $("#newFolder--name").val("");
            $("#newFolder--path").val(currentPath);
            $("#newFolder--error").hide();
            
        }
        function rename() {

            const $window = $(".window#rename");
            
            $window.show().css("zIndex", 11);

            center($window[0]);

            $("#rename--name").val("");
            $("#rename--path").val(currentPath);
            $("#rename--error").hide();

            
            
        }
        function openSettings() {

            const $window = $(".window#settings");
            
            $window.show().css("zIndex", 11);

            center($window[0]);

            $("#settings--syntax")[0].checked = settings.syntaxhighlight;

            updateSettingsStyleEditor();

        }
        function updateSettingsStyleEditor() {

            $(".styleEditor").each((index, ele) => {

                const elem = $(ele);
                const _style = elem.attr("for");
                const setting = settings.syntaxStyle[_style];

                elem.html("");

                for (const i in setting) {

                    const key = $("<input>").val(setting[i][0]).addClass("window--input").attr("styletype","key").attr("index", i);
                    const value = $("<input>").val(setting[i][1]).addClass("window--input").attr("styletype","value").attr("index", i);

                    if (setting[i][1].startsWith("#") && setting[i][1].length == 7) value.attr("type", "color");

                    elem.append(key)
                    .append(value)
                    .append($("<div></div>").addClass("styleEditor--remove--container")
                        .append($("<span></span>").html("&times;").addClass("styleEditor--remove"))
                        .on("click", e => {
                            styleEditorRemove(_style, i);
                        }))
                    .append("<br>");

                }

                elem.find(".window--input").on("input", e => {

                    styleEditorChange(e.currentTarget);

                });

                elem.append($("<span></span>").text("+").addClass("styleEditor--add").on("click", e => { styleEditorAdd(_style); }));

            });

        }
        function styleEditorAdd(style) {

           settings.syntaxStyle[style].push(["",""]);

           updateSettingsStyleEditor();

        }
        function styleEditorRemove(style, i) {

            settings.syntaxStyle[style].pop(i);

            updateSettingsStyleEditor();

        }
        function styleEditorChange(elem) {

            const $elem = $(elem);
            const $syntaxStyle = $("#syntaxStyle");
            const style = $elem.parent().attr("for");
            const index = $elem.attr("index");
            const spacing = true;

            if ($elem.attr("styletype") == "key") {

                settings.syntaxStyle[style][index][0] = $elem.val();

            } else {

                settings.syntaxStyle[style][index][1] = $elem.val();

            }

            let text = "";

            for (const style in settings.syntaxStyle) {

                const syntaxStyle = settings.syntaxStyle[style];

                text += (spacing ? "        " : "") + "syntax."+ style + " {" + (spacing ? "\n" : "");

                for (let i = 0; i < syntaxStyle.length; i++) {

                    text += (spacing ? "            " : "") + syntaxStyle[i][0] + ": " + syntaxStyle[i][1] + ";" + (spacing ? "\n" : "");

                }

                text += (spacing ? "        " : "") + "}" + (spacing ? "\n" : "");

            }

            $syntaxStyle.html(text);

        }
        function center(elem) {

            const box = elem.getBoundingClientRect();

            elem.style.left = window.innerWidth / 2 - box.width / 2 + "px";
            elem.style.top = window.innerHeight / 2 - box.height / 2 + "px";

        }
        function openFind() {

            const $window = $(".window#find");

            $window.show();
            center($window[0]);
            $("#find--error").hide().html("");

            if (editingFile) $("#find--this")[0].checked = true;
            else             $("#find--all")[0].checked = true;

        }
        function getCaretPos() {

            /*
            const selection = window.getSelection();
            if (selection.type != "Caret") console.warn(`The current selection type is ${selection.type}, not a caret`);

            const range = selection.getRangeAt(0);

            const temp = document.createElement("span");
            range.insertNode(temp);

            const box = temp.getBoundingClientRect();

            temp.remove();

            return {
                x : box.x,
                y : box.y
            }
            */

            const selection = window.getSelection();
            const range = selection.getRangeAt(0);

            const box = range.getBoundingClientRect();

            return {
                x: box.x,
                y: box.y
            }

        }
        function autoComplete(text) {

            const selection = window.getSelection();
            const range = selection.getRangeAt(0);
            const node = document.createTextNode(text);

            range.insertNode(node);

            range.setStartAfter(node);
            range.setEndAfter(node);

            selection.removeAllRanges();
            selection.addRange(range);

            updateEditorDisplay();
            $("#editor--autocomplete").remove();

        }
        /* qffunctions */
    </script>
    </head>

    <body>

        <div id="editor">
            <div id="editor--display"></div>
            <div id="editor--input" contenteditable autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></div>
        </div>

        <div id="path"></div>
        <div id="dir"></div>

        <div class="window" id="newFile">
            <div class="window--top">
                <span class="window--top--title">New File</span>
                <span class="window--top--close">&times;</span>
            </div>
            <div class="window--body">
                <label for="newFile--name">Name</label>
                <input id="newFile--name" class="window--input">
                <span>.</span>
                <input id="newFile--extension" value="mcfunction" class="window--input">

                <br>

                <label for="newFile--path">Path</label>
                <input  id="newFile--path" class="window--input">

                <button id="newFile--create" class="window--button">Create File</button>

                <span id="newFile--error"></span>
            </div>
        </div>

        <div class="window" id="newFolder">
            <div class="window--top">
                <span class="window--top--title">New folder</span>
                <span class="window--top--close">&times;</span>
            </div>
            <div class="window--body">
                <label for="newFile--name">Name</label>
                <input id="newFile--name" class="window--input">

                <br>

                <label for="newFolder--path">Path</label>
                <input  id="newFolder--path" class="window--input">

                <button id="newFolder--create" class="window--button">Create Folder</button>

                <span id="newFolder--error"></span>
            </div>
        </div>
        
        <div class="window" id="rename">
            <div class="window--top">
                <span class="window--top--title">Rename</span>
                <span class="window--top--close">&times;</span>
            </div>
            <div class="window--body">
                <label for="rename--name">Filename</label>
                <input id="rename--name" class="window--input">
                
                <span>.</span>

                <input id="rename--ext" class="window--input">
                
                <input id="rename--path">

                <button id="rename--go" class="window--button">Rename</button>

                <span id="rename--error"></span>
            </div>
        </div>

        <div class="window" id="load">
            <div class="window--top">
                <span class="window--top--title">Load</span>
                <span class="window--top--close">&times;</span>
            </div>
            <div class="window--body">
                <input type="file" id="load--file" class="window--input" accept=".zip">

                <progress id="load--progress"></progress>

                <span id="load--info"></span>

                <button id="load--go" class="window--button">Load</button>

                <span id="load--error"></span>
            </div>
        </div>

        <div class="window" id="settings">
            <div class="window--top">
                <span class="window--top--title">Settings</span>
                <span class="window--top--close">&times;</span>
            </div>
            <div class="window--body">

                <p class="settings--subtitle">Syntax highlighting</p>

                <label for="settings--syntax">Syntax highlighting</label>
                <input type="checkbox" id="settings--syntax" onchange="settings.syntaxhighlight = this.checked;">

                <br><br>

                <span>Comment</span>
                <div class="styleEditor" for="comment"></div>

                <span>Error</span>
                <div class="styleEditor" for="error"></div>

                <span>Entity Selector</span>
               <div class="styleEditor" for="entity_selector"></div>

                <span>Entity Selector Inside</span>
                <div class="styleEditor" for="entity_selector_inside"></div>

                <span>Entity Selector Not</span>
                <div class="styleEditor" for="entity_selector_not"></div>

                <span>Entity Selector Comma</span>
                <div class="styleEditor" for="entity_selector_comma"></div>

                <span>String</span>
                <div class="styleEditor" for="string"></div>

                <span>Function</span>
                <div class="styleEditor" for="function"></div>

                <br>

                <button id="settings--syntaxStyle--download">Download current style</button>
                <button id="settings--syntaxStyle--load">Load style from file</button>
                <input type="file" id="settings--syntaxStyle--load--input" accept=".css">


            </div>
        </div>

        <div class="window" id="find">
            <div class="window--top">
                <span class="window--top--title">Find and Replace</span>
                <span class="window--top--close">&times;</span>
            </div>
            <div class="window--body">

                <form id="find--type">

                    <input type="radio" id="find--all" name="find--type">
                    <label for="find--all">Find in all files</label>

                    <input type="radio" id="find--this" name="find--type">
                    <label for="find--this">Find in this file</label>

                </form>

                <input type="checkbox" id="find--case">
                <label for="find--case">Case sensitive</label>

                <br>

                <input id="find--find" placeholder="Find" class="window--input">

                <br><br>

                <input type="checkbox" id="find--replace--check">
                <label for="find--replace--check">Replace</label>

                <div id="find--replace--container">

                    <input id="find--replace" placeholder="Replace" class="window--input">

                    <br>

                    <button id="find--replace--go">Replace</button>

                </div>

                <p id="find--result"></p>
                <p id="find--error"></p>

            </div>
        </div>

        <div class="window" id="news">
            <div class="window--top">
                <span class="window--top--title">News</span>
                <span class="window--top--close">&times;</span>
            </div>
            <div class="window--body">

                <p class="news--subtitle">2.0</p>
                <p>The older versions were really badly coded so here's the 2.0 version!</p>
                <ul>
                    <li>Recoded everything!</li>
                    <li>Added top menu bar</li>
                    <li>Added a custom editor with syntax highlighting and autocompletion for the function command (more comming soon).</li>
                    <li>Added fullscreen button</li>
                    <li>Added settings</li>
                    <li>Updated some textures</li>
                    <li>Fixed bugs</li>
                </ul>

            </div>
        </div>

        <div id="contextmenu"></div>

        <nav id="nav">
            <div class="nav">
                <button class="nav--a">File</button>
                <div class="nav--contextmenu">
                    <button class="nav--a nav--b" id="nav--download">Download</button>
                    <button class="nav--a nav--b" id="nav--load">Load</button>
                    <button class="nav--a nav--b" id="nav--settings">Settings</button>
                    <button class="nav--a nav--b" id="nav--news">News</button>
                    <button class="nav--a nav--b" id="nav--newfile">New File</button>
                    <button class="nav--a nav--b" id="nav--newfolder">New Folder</button>
                </div>
            </div>
            <div class="nav">
                <button class="nav--a">Edit</button>
                <div class="nav--contextmenu">
                    <button class="nav--a nav--b" id="nav--find">Find and replace</button>
                </div>
            </div>
            <div class="nav">
                <button class="nav--a" id="view">View</button>
                <div class="nav--contextmenu">
                    <button class="nav--a nav--b" id="nav--fullscreen">Enter fullscreen</button>
                    <button class="nav--a nav--b" id="nav--deleted">Deleted files</button>
                    <button class="nav--a nav--b" id="nav--resetdir">Home directory</button>
                </div>
            </div>
            <span id="version"></span>
        </nav>
    </body>
</html>